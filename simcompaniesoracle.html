<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <title>SimCompanies Oracle</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        table { border-collapse: collapse; width: 100%; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
        th { background-color: #f2f2f2; }
    </style>
</head>
<body>
    <h1>SimCompanies Oracle: Marktpreise</h1>
    <table id="market-table">
        <thead>
            <tr>
                <th>Artikel Name</th>
                <th>Marktpreis</th>
            </tr>
        </thead>
        <tbody>
        </tbody>
    </table>

    <script>
        async function loadData() {
            try {
                // 1. CSV aus GitHub laden
                const csvUrl = 'https://raw.githubusercontent.com/FirasGhasi/SimCompaniesOracle/main/resources.csv';
                const csvResponse = await fetch(csvUrl);
                const csvText = await csvResponse.text();

                // CSV in Array von Objekten umwandeln
                const resources = csvText.split('\n').slice(1).map(line => {
                    const [id, name] = line.split(';'); // Semikolon als Trennzeichen
                    return { id: id.trim(), name: name.trim() };
                });

                // 2. Marktdaten von SimCompanies API abrufen
                const marketResponse = await fetch('https://www.simcompanies.com/api/v3/market-ticker/0/');
                const marketData = await marketResponse.json();

                // 3. Ressourcen mit Marktpreisen kombinieren
                const tableBody = document.querySelector('#market-table tbody');
                resources.forEach(resource => {
                    const marketItem = marketData.find(item => item.kind == resource.id);
                    const price = marketItem ? marketItem.price : 'â€“';
                    const row = document.createElement('tr');
                    row.innerHTML = `<td>${resource.name}</td><td>${price}</td>`;
                    tableBody.appendChild(row);
                });

            } catch (error) {
                console.error('Fehler beim Laden der Daten:', error);
            }
        }

        loadData();
    </script>
</body>
</html>
